<app-toolbar (toggleDrawer)="toggleAlertDrawer()"
              (createField)="toggleCreateField()"
              (waterPump)="toggleWaterPump()"
              (toggleSensors)="toggleSensors()"
              (toggleIrrigation)="toggleIrrigation()"
              (logout)="toggleLogOut()"
              [selectedField]="selectedField">
</app-toolbar>

<div class="dashboard-grid">
  <!-- LEFT PANEL -->
  <div class="left-panel">
    <!-- News Section -->
    <div class="news-section">
      <div class="news-card" *ngFor="let news of paginatedNews">
        <img [src]="news.imageUrl" alt="news image" class="news-image" />
        <div class="news-details">
          <h3>{{ news.title }}</h3>
          <a mat-button color="accent" [href]="news.newsUrl" target="_blank">Read More</a>
        </div>
      </div>
      <mat-paginator [length]="newsItems.length" [pageSize]="newsPageSize" [pageIndex]="newsPageIndex" (page)="onNewsPageChange($event)"></mat-paginator>
    </div>

    <!-- Scheduler & Irrigation Toggles -->
    <div class="toggle-options">
      <button mat-stroked-button color="primary" (click)="openSchedulerIntervalDialog()">
        <mat-icon>update</mat-icon> Sensor Update Interval
      </button>
      <button mat-stroked-button color="accent" (click)="openIrrigationIntervalDialog()">
        <mat-icon>water_drop</mat-icon> Irrigation Interval
      </button>
      <!-- Check Weather for Selected Field -->
      <div *ngIf="selectedField" class="check-weather-wrapper">
        <button mat-flat-button color="primary" (click)="checkWeatherForSelectedField()">
          <mat-icon>cloud</mat-icon>
          Check Weather
        </button>
      </div>
    </div>
  </div>

  <!-- RIGHT PANEL -->
  <div class="right-panel">
    <!-- Fields Section -->
    <div class="field-grid">
      <mat-card class="field-card" *ngFor="let field of paginatedFields" (click)="selectField(field)" [ngClass]="{ 'selected': selectedField?.id === field.id }">
        <div class="selected-badge" *ngIf="selectedField?.id === field.id">
          <mat-icon>check_circle</mat-icon>
        </div>
        <mat-card-header>
          <img mat-card-avatar src="https://images.icon-icons.com/3093/PNG/512/field_icon_191455.png" alt="field">
          <mat-card-title>{{ field.crop_name }}</mat-card-title>
          <mat-card-subtitle>{{ field.soil_type }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <p><strong>Dimensions:</strong> {{ field.length }}m x {{ field.width }}m</p>
          <p><strong>Slope:</strong> {{ field.slope }}%</p>
        </mat-card-content>

        <mat-card-actions>
          <button mat-button color="primary" (click)="openFieldDetails(field); $event.stopPropagation()">Details</button>
          <button mat-button color="warn" (click)="deleteField(field.id, field.sensors, $event)">Delete</button>
        </mat-card-actions>
      </mat-card>
    </div>
    <mat-paginator [length]="fields.length" [pageSize]="fieldsPageSize" [pageIndex]="fieldsPageIndex" (page)="onFieldsPageChange($event)" class="fields-paginator"></mat-paginator>


  <!-- Weather Forecast Section -->
	<div class="weather-forecast-container" *ngIf="forecastData.length > 0">
		<div class="weather-scroll">
		  <div class="weather-day" *ngFor="let day of forecastData">
			<div class="day-name">{{ day.day }}</div>
			<img [src]="day.icon" alt="weather icon" class="weather-icon" />
			<div class="temp-range">{{ day.max }}Â° / {{ day.min }}Â°</div>
			<div class="details">
			  Avg: {{ day.avg }}Â°<br>
			  ðŸ’§ {{ day.humidity }}%<br>
			  ðŸ’¨ {{ day.wind }} km/h
			</div>
		  </div>
		</div>
	  </div>
  </div>
</div>

<!-- FAB Alert Icon -->
<button mat-fab class="fab-alert" (click)="toggleAlertDrawer()">
	<mat-icon>notifications</mat-icon>
</button>
